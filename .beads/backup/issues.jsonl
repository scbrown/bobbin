{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skipping","closed_at":"2026-02-27T19:22:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-02zcp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:22:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-084bw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Empty queue cycle","closed_at":"2026-02-27T19:34:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-092mp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:34:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, no branches to rebase","closed_at":"2026-02-27T20:05:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0b833","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:05:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:14:44Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0eu8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:14:44Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Empty queue","closed_at":"2026-02-27T19:36:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0f4rf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:36:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Auto-land disabled, nothing to do","closed_at":"2026-02-27T19:45:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0fkwx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:45:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:15:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0j0a","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:15:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:19:55Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0kh35","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:19:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0nkp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:17:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"No branches to rebase — queue empty","closed_at":"2026-02-27T19:45:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0nlx9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:45:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Await-signal timeout (30s), looping to next patrol","closed_at":"2026-02-27T19:47:10Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0pdoj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:47:10Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:37:16Z","closed_by_session":"bba4ffba-f85b-4bf3-a9e6-df848336ce40","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0r1xi","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:37:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0rgu8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:49:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0smz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:03:25Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:18Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0u2t7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:03:18Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Timeout, no activity. Looping.","closed_at":"2026-02-27T19:33:55Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:30:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0x6ep","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:33:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0y9hv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:11:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-0z6ri","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:59:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-19mc5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:01:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:03Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1ac3t","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:25:03Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1ava2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:57:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1dg9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:17:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1hke","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:17:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1kt4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:17:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1kuj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:07:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"No branches to test — queue empty","closed_at":"2026-02-27T19:45:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1lsos","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:45:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:37:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1m5e7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:37:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1qvho","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:38:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:09:06Z","closed_by_session":"df73d6a2-0ca7-4809-81b3-de68595b65a7","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1sd7w","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:09:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-1vg17","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"hooked","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-202i","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-212ww","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:30:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:43Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-21ur","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:04:43Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-25517","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:23:55Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-287f4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:23:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:18:57Z","closed_by_session":"e54f152a-a29a-468c-930c-54a3faa97f64","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-28a6","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:18:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Healthy: RSS 3MB, session light, context low","closed_at":"2026-02-27T20:08:01Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-295l8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:08:01Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2aaxx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:29:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:36:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2aqu5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:36:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2b9ot","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"No mail","closed_at":"2026-02-27T19:47:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2epx2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:47:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:24:20Z","closed_by_session":"3666b0ff-ebc7-4d14-8013-9d9bcfc8ac79","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2fgrt","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:24:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:11:02Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2gdoz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:11:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2h0sm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2hxqt","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:53:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2r6ru","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:51:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:20:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2rzux","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:20:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:22:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2tl6a","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:22:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2u5et","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:29:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2vg77","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:55:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Session healthy — RSS 3MB, fresh, low context, empty queue","closed_at":"2026-02-27T19:34:42Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2vpux","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:34:42Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"RSS: 3MB, healthy","closed_at":"2026-02-27T19:47:43Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-2vvsq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:47:43Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-31f2y","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:23:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-36eqo","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:23:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-38pt8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:52:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3al6i","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:53:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:14:15Z","closed_by_session":"dc9a4a65-2928-4999-89a6-0d27f4674e1d","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3bkf","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:14:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:56:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3bldi","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:56:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3hdop","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:44:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skip","closed_at":"2026-02-27T20:07:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3j2cd","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:07:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:46Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3ronw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:13:46Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3tgvl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:26:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Session healthy — RSS 3MB, low context","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3u4y7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:10:09Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3xg4b","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:10:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-3y2l","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:02:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:03Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-41of6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:29:03Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:44Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-43cnv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:40:44Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, no branches to merge","closed_at":"2026-02-27T20:05:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-48rux","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:05:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4bnb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:05:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:16:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4odl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:16:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4ssgp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:26:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:02:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4u6b8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:02:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:23:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4ubj1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:23:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:24:11Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4vvzk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:24:11Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4yjc0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:26:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4yld7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:30:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-4zf0h","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Auto-land disabled, nothing to do.","closed_at":"2026-02-27T20:05:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-52awz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:05:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:22:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-55pbv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:22:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:16:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-565z","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:16:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-58tc","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:03:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:36:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5aiar","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:36:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Handing off — persistent empty queue","closed_at":"2026-02-27T19:48:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5anjz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:48:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5b08h","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:57:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5blez","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:03:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5cax","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:03:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:14:15Z","closed_by_session":"dc9a4a65-2928-4999-89a6-0d27f4674e1d","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5gnb","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:14:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:34:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5idtg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:34:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5k4dh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:26:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5kvhp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:30:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Auto-land disabled","closed_at":"2026-02-27T19:36:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-5lruw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:36:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:05:18Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-61nsi","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:05:18Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-67yd8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:44:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:34:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6a234","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:34:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6a3b6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:38:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6b7bb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:11:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6cqi3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:09:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:59Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6cw1z","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:49:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6fz6w","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:38:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6iqv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:07:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6lokz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:03:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Auto-land disabled, nothing to do","closed_at":"2026-02-27T19:32:37Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:30:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6qxm8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:32:37Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, nothing to test","closed_at":"2026-02-27T19:32:06Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:30:53Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6v5pd","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:32:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6vng","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:03:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6xxkl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:44:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-6yqwr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:55:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-70sm8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:44:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-74xl3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:25:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:12:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-76gjw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:15:20Z","closed_by_session":"891e0b20-5a6d-4d49-8b03-2961590dd48a","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:12:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-773mr","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-778uf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:01:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:52:44Z","closed_by_session":"67b00d32-7fe9-44e2-b39a-87f8cc1aeee5","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-79fpn","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:52:44Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:15:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7a16o","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:15:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7a2bv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:09:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7b0vr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Handing off — 4 empty cycles, accumulated context","closed_at":"2026-02-27T19:37:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7htvp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:37:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7i13t","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7kzwx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:57:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7ux2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:07:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7vl2p","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7wb09","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:44:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-7xwt","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:54:10Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-834io","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:54:10Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:12:14Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-84uby","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8fukh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:03:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8hym3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:38:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8ia3n","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8kaa","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:02:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:11:02Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8ni43","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:11:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:15:20Z","closed_by_session":"891e0b20-5a6d-4d49-8b03-2961590dd48a","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8qeyp","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Session healthy — RSS 3MB, fresh session, low context, empty queue","closed_at":"2026-02-27T19:32:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:30:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8qyo1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:32:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:10:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8scbg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:10:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8u8dk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8wu8e","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-8yl1u","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-933kb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:29:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-95ui","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:02:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9645x","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:09:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-98oqw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:57:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skipping","closed_at":"2026-02-27T19:22:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9e2un","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:22:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:58:37Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9i8xs","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:58:37Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:04:35Z","closed_by_session":"db7d08ad-a8c2-409c-8882-4ec687d2e303","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9mtys","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:04:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9nvfw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:09:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9oa57","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:26:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:21Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:12:14Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9pczw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:13:21Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9qw4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:17:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9r3p","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:07:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:54:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9sil1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:54:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9ukz2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-9x2zp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:15:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-a811","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:15:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-a9ci","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:04:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-aa37","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:07:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ab583","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:57:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ae3pr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:44:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:15:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ae9t","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:15:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:15:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-afdn","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:15:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:43:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-aho0h","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:43:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-aijuv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-akw6p","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:55:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"No branches in queue — queue empty","closed_at":"2026-02-27T19:45:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-alss5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:45:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-alvnt","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:51:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:18Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ampdf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:40:18Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:03:57Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ang0l","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:04:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Inbox clean","closed_at":"2026-02-27T19:34:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-apz1w","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:34:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:37Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-aqbzq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:01:37Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-avy4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:19:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-b03da","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:19:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skipping","closed_at":"2026-02-27T19:22:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-b4pub","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:22:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, no tests to run","closed_at":"2026-02-27T20:05:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-b59tr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:05:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-b9ss6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:44:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:01:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bbos","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:01:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:12:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bd4p5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:22:11Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bgsta","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:22:11Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bkgo","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:03:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:31:14Z","closed_by_session":"502fe9da-82f5-4a25-8b9a-0366b2d5aedb","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bl4i6","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:31:14Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:36Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bnssh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:57:36Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-boml7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:25:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:28:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-brd75","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:28:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bu8d","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:17:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-buevw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:01:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:44Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bvjn3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:53:44Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:37:16Z","closed_by_session":"bba4ffba-f85b-4bf3-a9e6-df848336ce40","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-bzmc5","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:37:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c008a","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c012y","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:03:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c14jw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c1bxw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:55:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:41:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c1q07","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:41:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:01Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:00:06Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c4ess","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:01:01Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:37Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c4m5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:18:37Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:12:14Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c7vy3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:21:30Z","closed_by_session":"bcd79432-ab7c-41d4-a911-a7fac526390f","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:18:57Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-c8anz","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:21:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:20:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-cdbw3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:20:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:39:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-cga4r","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:39:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-cilge","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:51:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Cycle 2: 0 branches, empty queue","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-cm73x","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:43:02Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-codt7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:43:02Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-crjxw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:53:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ctyd0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:03:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Patrol: empty queue, 0 branches merged, 0 conflicts, no escalations","closed_at":"2026-02-27T20:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-cz926","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-czjf1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:09:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skip","closed_at":"2026-02-27T20:07:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-czjq9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:07:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-d8yik","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-da17","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dajil","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:26:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dau9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dbojd","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:44:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dihcv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:44:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dlig","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:17:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dmotl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Signal received, looping","closed_at":"2026-02-27T19:35:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dnosc","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:35:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Auto-land disabled","closed_at":"2026-02-27T20:07:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-do5yg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:07:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dpyq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:18:57Z","closed_by_session":"e54f152a-a29a-468c-930c-54a3faa97f64","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dq8z","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:18:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-duchb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:15:20Z","closed_by_session":"891e0b20-5a6d-4d49-8b03-2961590dd48a","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-dxibx","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Healthy: RSS 3MB, session 65m, context low. Continue.","closed_at":"2026-02-27T20:06:14Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-e02ou","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:06:14Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-e6vut","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-e92rl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:30:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:18:57Z","closed_by_session":"e54f152a-a29a-468c-930c-54a3faa97f64","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ebd8","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:18:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:39:09Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-epc0l","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:39:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Auto-land disabled","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-eqcnx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-erpez","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:51:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:58:55Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-et4pw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:58:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T20:07:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ev9js","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:07:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ewa3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-f0bn","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:07:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-f1gy5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fg4a","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fih6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:07:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:24:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fmjjq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:24:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fmyx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:23:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ftoeu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:23:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Empty queue cycle — 0 branches merged, 0 conflicts, 0 issues filed","closed_at":"2026-02-27T19:32:21Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:30:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fulds","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:32:21Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:12:14Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fvuzz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"No tests run — queue empty","closed_at":"2026-02-27T19:45:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fwfzb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:45:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, nothing to rebase","closed_at":"2026-02-27T19:32:06Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:30:53Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-fxoci","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:32:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-g0d10","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:49:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-g2hy2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:49:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-g335","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-g8ka","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:02:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gaews","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gb7we","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:49:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gbdxt","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:57:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:50:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gd0nu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:50:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:03Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gdnnh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:29:03Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:24:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gl3n0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:24:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-glm9l","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:11:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:14Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gmqix","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:30:14Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gppg6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:55:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gqpdk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:03Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gr9j","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:02:03Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gwbtt","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:44:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-gxc0f","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:59:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:11:02Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-h2mxg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:11:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-h2wzk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:09:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-h69yx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-h9vkn","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:03:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hf7ec","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:53:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Healthy","closed_at":"2026-02-27T19:36:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hgk5c","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:36:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:09Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hgos","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:02:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hidg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hlhz9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:40:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hn5uw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:30:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hq232","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:01:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hsypc","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:44:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-htkr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hy6g9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:53:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-hy97k","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:51:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:00:06Z","closed_by_session":"da767715-ddb2-4f74-9bf2-6289416ab258","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-i74bq","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:00:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ib6f5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:51:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ievfg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:09:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:20:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-iifoq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:20:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:36:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-imwid","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:36:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:16:59Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-irq3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:16:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-isexc","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:03:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ivy54","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:42:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ixem","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:16:21Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-iz18","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:16:21Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-izqb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:03:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:23:18Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-j1pg8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:23:18Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:48:33Z","closed_by_session":"64028dca-f6b8-48ca-bb09-3c94818949ad","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-j1vew","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:48:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"No mail","closed_at":"2026-02-27T19:36:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-j2j53","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:36:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-j48cf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-j562q","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:34:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-j7kxq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:34:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:12:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-j929c","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Inbox empty, no orphaned MRs","closed_at":"2026-02-27T20:08:02Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-jafwq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:08:02Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-japbf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-jcdf9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:51:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-jpw28","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:38:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-jrfa","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:56:23Z","closed_by_session":"9fa9e899-a619-447b-93de-edfef818bbac","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:55:04Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-jvujq","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:56:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-jwhub","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-k1iss","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:26:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Timeout, no signal. Looping to cycle 3.","closed_at":"2026-02-27T20:08:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-k21ca","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:08:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:27:46Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-k6362","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:27:46Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-k78wg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:49:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Inbox empty, no orphaned MRs","closed_at":"2026-02-27T19:33:09Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:30:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-k7q5n","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:33:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-k924c","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:57:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kb6e2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:12:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, no failures to handle","closed_at":"2026-02-27T19:32:07Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:30:53Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-khzt1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:32:07Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kjgz0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:03:57Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kn4zl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:04:25Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ko9hw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:51:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kq4yo","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kv6e9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:49:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kvvim","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kxh51","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:30:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Auto-land disabled","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ky0vv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:31:14Z","closed_by_session":"502fe9da-82f5-4a25-8b9a-0366b2d5aedb","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-kye16","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:31:14Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:52:44Z","closed_by_session":"67b00d32-7fe9-44e2-b39a-87f8cc1aeee5","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:52:12Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-l0zq9","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:52:44Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:19:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:18:57Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-l5g8r","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:19:25Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-l5n0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:07:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ldaq4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:38:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:19:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lg7xu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:19:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:28:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lgg29","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:28:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:47:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lhybf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:47:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:12:14Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lm73t","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lmc2v","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:51:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Timeout, no signal. Looping to next patrol cycle.","closed_at":"2026-02-27T20:07:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lnhld","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:07:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lppf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lq7l2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lt17","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:14:15Z","closed_by_session":"dc9a4a65-2928-4999-89a6-0d27f4674e1d","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ltqk","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:14:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:23:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-luyto","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:23:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lv1i","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-lxwxh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-m0ivl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:53:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-m1trn","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:01:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Empty queue cycle","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-m5sq9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-m75l","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-m8i52","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:36:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mdey8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:36:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mdto","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:02:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mejkm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:01:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:09:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mfe42","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:09:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:56:23Z","closed_by_session":"9fa9e899-a619-447b-93de-edfef818bbac","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mfivi","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:56:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mh9bp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:40:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mlky9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:46Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mnxm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:05:46Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:15:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mpsq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:15:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mqc0d","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:42:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:31:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:30:53Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mspp7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:31:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:45:37Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mvegp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:45:37Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:34:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mwlrm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:34:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-mxn31","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:11:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-myp2h","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:55:04Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-n0nxv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:55:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-n1j1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:03:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-n66wv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:42:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-nbc2l","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:52:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-nbft0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:48:33Z","closed_by_session":"64028dca-f6b8-48ca-bb09-3c94818949ad","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ncnrk","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:48:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ngw9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:05:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ni1dw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:41:47Z","closed_by_session":"67456f8a-42ef-4982-85fd-27235bf5dacf","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-nilxu","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:41:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-noe1g","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:42:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:15:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-np05","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:15:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-nsob","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:05:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-nv2qf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:25:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-o1ll","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:02:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-o46mi","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:11:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skip","closed_at":"2026-02-27T20:07:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-o4rq3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:07:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:36:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-o5pnl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:36:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-o65yx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Inbox empty, no orphaned MRs","closed_at":"2026-02-27T19:46:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-o8act","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:46:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:14:15Z","closed_by_session":"dc9a4a65-2928-4999-89a6-0d27f4674e1d","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-od7g","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:14:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ogtky","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:55:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, no failures to handle","closed_at":"2026-02-27T20:05:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-oi4rz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:05:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-oke4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:03:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-omk99","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-opb6v","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:38:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-opx7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:05:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ov29u","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:55:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-oxo46","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:53:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-p7xj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:17:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skip","closed_at":"2026-02-27T20:07:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-p86iu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:07:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pbsn","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pdb5r","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:52:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:37:16Z","closed_by_session":"bba4ffba-f85b-4bf3-a9e6-df848336ce40","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-peoez","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:37:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-phcbz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:03:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:15:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:14:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pj25","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:15:25Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:00:06Z","closed_by_session":"da767715-ddb2-4f74-9bf2-6289416ab258","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-plnxz","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:00:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Clean","closed_at":"2026-02-27T19:36:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pp5tr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:36:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:04:35Z","closed_by_session":"db7d08ad-a8c2-409c-8882-4ec687d2e303","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:00:06Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pq26g","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:04:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:19:46Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pqjy9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:19:46Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pqm9j","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:25:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pumu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:07:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:34:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pxfnz","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:34:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-pzqag","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:40:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-q2xwf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-q5d3s","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:30:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-q62x","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:17:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:19:55Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-q6mop","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:19:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-q6wyv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:29:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:22:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-q72ue","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:22:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:23:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qcuoe","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:23:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:21:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qj4ff","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:21:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qjgcu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ql7p","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qpoli","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qut5r","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:40:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:34:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qv3r6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:34:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:12:14Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qwkyo","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:27:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qww5b","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:27:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:37:17Z","closed_by_session":"bba4ffba-f85b-4bf3-a9e6-df848336ce40","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:30:53Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-qy8ty","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:37:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:04:35Z","closed_by_session":"db7d08ad-a8c2-409c-8882-4ec687d2e303","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:03:57Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-r0gsz","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:04:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-r3g26","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:11:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Patrol cycle: 0 branches merged, empty queue, no conflicts, no escalations","closed_at":"2026-02-27T19:46:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-r7330","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:46:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-r7i7a","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:29:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rd1cr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:24:06Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rdj8o","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:24:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"No branches to merge — queue empty","closed_at":"2026-02-27T19:45:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rdzk6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:45:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rffa3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rg6f","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:04:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ripa","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:03:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rnbwm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:52:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rnnq7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:57:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:31:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:30:53Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rr2gx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:31:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:52:44Z","closed_by_session":"67b00d32-7fe9-44e2-b39a-87f8cc1aeee5","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rsial","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:52:44Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ru881","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:42:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rw5w9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:30:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:10:18Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rxg94","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:10:18Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rxxf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:04:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:11:02Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rye55","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:11:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-rzdh3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:51:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-s25j","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:04:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:56:55Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-s3lyq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:56:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-s5b5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:07:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-s5q5h","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-s616","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:07:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-s8ddh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:55:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:45:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-scua1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:45:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Inbox clean, no orphaned MRs","closed_at":"2026-02-27T19:47:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:47:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sevpm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:47:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:12:14Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sh11q","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:12:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sk615","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:40:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-skwyp","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:49:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-slq0m","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:44:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sm7ln","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:44:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sop6w","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sqmrd","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:04:25Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:09:06Z","closed_by_session":"df73d6a2-0ca7-4809-81b3-de68595b65a7","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sr7dr","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:09:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:23:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-srlq6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:23:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-stk69","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:02:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:00:07Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-suda7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:02:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:44:59Z","closed_by_session":"c7f1ec47-fd19-46f8-b72c-bcbf8bb2ab10","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:44:15Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-sybn9","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:44:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"RSS: 3MB, fresh session, low context — healthy","closed_at":"2026-02-27T19:46:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:44:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-t1yxr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:46:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:02:46Z","closed_by_session":"d14f9fb8-ea65-4863-880e-eed1e4b1589e","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-t3yf","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:02:46Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:03:43Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:02:46Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-t419","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:03:43Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:11:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:11:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tazcc","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:11:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:07:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:06:59Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tb1h","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:07:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tdexc","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:29:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tdp2l","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:59:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tgb9m","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T20:03:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-thxt4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T20:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:40Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ticci","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:26:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tkla","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:02:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:10:01Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:08:48Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-toch2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:10:01Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:10Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tpxcm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:25:10Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:12:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-tqx45","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:12:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-trbmf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:18:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:18:25Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-trz2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:18:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:54:00Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ttm14","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:54:00Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-txqca","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:44:59Z","closed_by_session":"c7f1ec47-fd19-46f8-b72c-bcbf8bb2ab10","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-txqkt","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:44:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:04:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-u0td","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:04:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:51:13Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:50:52Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-u78k7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:51:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-u9ili","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:40:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-u9zu0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ud4jl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:49:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Signal received, looping","closed_at":"2026-02-27T19:36:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ukaue","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:36:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skip","closed_at":"2026-02-27T20:07:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-unhdm","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:07:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:53:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:52:44Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-uo3lj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:53:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:20:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-uszex","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T19:20:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, no more work","closed_at":"2026-02-27T19:32:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:30:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-uukex","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:32:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-uvlu5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:38:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-uwh4e","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:42:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-uyhm0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:49:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:12:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:12:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-v22kj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:12:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:35:57Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-v3ut8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:35:57Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-v4nem","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:40:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-v6par","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:03:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:43:14Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vaj69","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:43:14Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:27:53Z","closed_by_session":"f915f087-8f31-4531-8baa-e3c31c5d4e86","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vm3ms","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:27:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vo5dl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:25:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:18Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vouji","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:42:18Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vp7aa","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:59:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:58:45Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vqidq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:59:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vs8e","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:17:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:05:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:05:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vw7r","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:05:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"No messages","closed_at":"2026-02-27T20:07:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-vyn72","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:07:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty","closed_at":"2026-02-27T19:36:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:36:16Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-w1bhk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:36:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, nothing to merge","closed_at":"2026-02-27T19:32:07Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:30:53Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-w6sqe","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:32:07Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Auto-land disabled","closed_at":"2026-02-27T19:23:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wawmj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:23:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wdjth","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:25:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Inbox clean","closed_at":"2026-02-27T19:35:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wganh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:35:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:42:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-whhv4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:42:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:24:20Z","closed_by_session":"3666b0ff-ebc7-4d14-8013-9d9bcfc8ac79","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wj6r6","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:24:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:41:47Z","closed_by_session":"67456f8a-42ef-4982-85fd-27235bf5dacf","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wnred","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:41:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Auto-land disabled","closed_at":"2026-02-27T19:34:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wp4bd","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:34:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"No mail","closed_at":"2026-02-27T19:35:42Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:35:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wqz7c","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:35:42Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:28:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wr2d7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:28:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:55:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ws6ba","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:55:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wtt2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:02:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-wypps","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T20:03:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-x1bin","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:30:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:55:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:55:04Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-x44iv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:55:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:02:09Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:01:18Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-x4ky","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:02:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skipping","closed_at":"2026-02-27T19:22:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xb2e0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:22:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:36Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xlwpu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:25:36Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, no loop needed","closed_at":"2026-02-27T20:05:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xocdu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T20:05:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Inbox empty, no orphaned MRs. Clean.","closed_at":"2026-02-27T20:06:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xotr7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T20:06:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T20:00:06Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xqb3w","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T20:01:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:20:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xsd61","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:20:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:19:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:18:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xt5s7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:19:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:29:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5060726a78c723f16d121ff7a0da885e7b04aa6792018a6e99b7ef62288c27b5","created_at":"2026-02-27T19:27:54Z","created_by":"","crystallizes":0,"defer_until":null,"description":"End of patrol cycle decision. Use the signals from context-check to decide.\n\n**If you decide to continue patrolling:**\n\nUse await-signal with exponential backoff to wait for MQ activity:\n\n```bash\ngt mol step await-signal --agent-bead gt-\u003crig\u003e-refinery --backoff-base 30s --backoff-mult 2 --backoff-max 5m\n```\n\nThis command:\n1. Subscribes to `bd feed --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs (e.g., MR submission)\n3. If no activity, times out with exponential backoff:\n   - First timeout: 30s\n   - Second timeout: 60s\n   - Third timeout: 120s\n   - ...capped at 5 minutes max\n4. Tracks `idle:N` label on refinery agent bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state gt-\u003crig\u003e-refinery --set idle=0\n```\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time).\n\nAfter await-signal returns (either by signal or timeout):\n1. **Re-assess session health** (check RSS, context, age again — conditions change)\n2. Squash the current wisp:\n```bash\nbd mol squash \u003cmol-id\u003e --summary \"\u003cpatrol-summary\u003e\"\n```\n3. Create and hook a new patrol wisp:\n```bash\nNEW_WISP=$(bd mol wisp mol-refinery-patrol --json | jq -r '.new_epic_id')\nbd update \"$NEW_WISP\" --status=hooked --assignee=\u003crig\u003e/refinery\n```\n4. Continue executing from the inbox-check step of the new wisp\n\n**If you decide to hand off:**\n\nSquash wisp with summary digest, then use `gt handoff` for clean session transition:\n\n```bash\ngt handoff -s \"Patrol complete\" -m \"Merged X branches, Y tests passed.\nQueue: empty/N remaining\nRSS: X MB, Session age: Xh\nNext: [any notes for successor]\"\n```\n\n`gt handoff` sends handoff mail to yourself, respawns with a fresh Claude instance,\nSessionStart hook runs gt prime, and your successor picks up from the hook.\n\n**DO NOT just exit.** Always use `gt handoff` for proper lifecycle.\n\n**IMPORTANT**: Never sleep-poll manually (e.g., `sleep 30 \u0026\u0026 bd list`).\nAlways use `gt mol step await-signal` — it's event-driven and tracks backoff state.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-xwiix","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Burn and respawn or loop","updated_at":"2026-02-27T19:29:53Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T20:15:20Z","closed_by_session":"891e0b20-5a6d-4d49-8b03-2961590dd48a","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T20:11:02Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-y5fy7","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"No mail","closed_at":"2026-02-27T19:34:21Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:34:03Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-y7m5w","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:34:21Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:15:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ya735","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:15:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yf82t","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:26:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yjqyw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:30:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:03:37Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T20:02:58Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yklkx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T20:03:37Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:01:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T20:00:06Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ynpt8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T20:01:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:25:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yntxe","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:25:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:23:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b5b41d316559ab36d81b013937c0b56a205c257b0f96499632c4e34fb4d420c5","created_at":"2026-02-27T19:23:27Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check the beads merge queue - this is the SOURCE OF TRUTH for pending merges.\n\n```bash\ngit fetch --prune origin\ngt mq list \u003crig\u003e\n```\n\nThe beads MQ tracks all pending merge requests. Do NOT rely on `git branch -r | grep polecat`\nas branches may exist without MR beads, or MR beads may exist for already-merged work.\n\nIf queue empty, skip to \"check-integration-branches\" step.\n\nFor each MR in the queue, verify the branch still exists:\n```bash\ngit branch -r | grep \u003cbranch\u003e\n```\n\nIf branch doesn't exist for a queued MR:\n- Close the MR bead: `bd close \u003cmr-id\u003e --reason \"Branch no longer exists\"`\n- Remove from processing queue\n\nTrack verified MR list for this cycle.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yqsv9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Scan merge queue","updated_at":"2026-02-27T19:23:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:05:03Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T20:04:35Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yrzuw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T20:05:03Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c84f59cd07f515d4b4786b82289433eb33ec7dee1ba9d433c4d34cae1388d0a6","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: run_tests = true**\n**Config: test_command = just test**\n**Config: setup_command = **\n**Config: typecheck_command = just check**\n**Config: lint_command = just lint**\n**Config: build_command = just build**\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: `just check`\nIf lint_command is set: `just lint`\nIf build_command is set: `just build`\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\njust check       # Check for type errors (if command set)\njust lint            # Check for lint errors (if command set)\njust build           # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n\nProceed to handle-failures step. Track which specific check failed\n(setup/typecheck/lint/build) for the failure diagnosis.\n\n**3. Run the test suite:**\n\nIf run_tests = \"false\": Skip this step entirely. Proceed to handle-failures.\n\nIf run_tests = \"true\":\n\n```bash\njust test            # Run tests (configured per-rig)\n```\n\nTrack results: pass count, fail count, specific failures.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-ys387","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Run quality checks and tests","updated_at":"2026-02-27T19:26:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yt5j","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:17:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:49:45Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"08a9203f5a61045888f0a3f59a1e662d6099816dd7eeb7b52193b55395288c45","created_at":"2026-02-27T19:48:34Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Assess whether this session should continue or hand off to a fresh one.\n\n**Gather signals:**\n\n1. **Process memory** — check your own RSS:\n```bash\nps -o rss= -p $$   # KB — divide by 1024 for MB\n```\n\n2. **Session age** — how long has this tmux session been running:\n```bash\nCREATED=$(tmux display-message -t $(tmux display-message -p '#S') -p '#{session_created}')\necho \"Session age: $(( ($(date +%s) - CREATED) / 3600 ))h\"\n```\n\n3. **Context usage** — your internal sense of how much context you've consumed.\nAre you losing track of earlier conversation? Getting verbose? Repeating yourself?\n\n4. **Work done this cycle** — how many merges, how much complexity processed.\n\n**The principle:** Fresh sessions are cheap. Memory bloat compounds over time and\naffects the entire system — other agents, Dolt, and the OS all share the same RAM.\nAn idle session at 1.5 GB is worse than cycling and restarting at 200 MB.\n\n**Make a judgment call.** If multiple signals suggest you're getting heavy\n(high RSS, long session, substantial context consumed), hand off. If you're\nlight and there's active work in the queue, continue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yt9i4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Assess session health","updated_at":"2026-02-27T19:49:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Queue empty, skipping","closed_at":"2026-02-27T19:22:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yu69c","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T19:22:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Patrol: empty queue, 0 branches merged, no issues","closed_at":"2026-02-27T20:07:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b5e05944ffa1bdf4128aaef30ac3c06ef054cc7d39f3300d133f260ec24c22a","created_at":"2026-02-27T20:07:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Summarize this patrol cycle.\n\n**VERIFICATION**: Before generating summary, confirm for each merged branch:\n- [ ] MERGED mail was sent to witness\n- [ ] MR bead was closed\n- [ ] MERGE_READY mail archived\n\nIf any notifications or archiving were missed, do them now!\n\nInclude in summary:\n- Branches merged (count, names)\n- MERGED mails sent (count - should match branches merged)\n- MR beads closed (count - should match branches merged)\n- MERGE_READY mails archived (count - should match branches merged)\n- Test results (pass/fail)\n- Branches with conflicts (count, names)\n- Conflict-resolution tasks created (IDs)\n- Issues filed (if any)\n- Any escalations sent\n\n**Conflict tracking is important** for monitoring MQ health. If many branches\nconflict, it may indicate main is moving too fast or branches are too stale.\n\nThis becomes the digest when the patrol is squashed.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yv94q","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Generate handoff summary","updated_at":"2026-02-27T20:07:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:26:49Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:26:29Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-yyq8f","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:26:49Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfab2e7b59734313316899e100837d3f7a1e7098c4c55ea83db66528f85eaefe","created_at":"2026-02-27T19:52:13Z","created_by":"","crystallizes":0,"defer_until":null,"description":"More branches to process?\n\n**Entry paths:**\n- Normal: After successful merge-push\n- Conflict-skip: After process-branch created conflict-resolution task\n\nIf yes: Return to process-branch with next branch.\nIf no: Continue to generate-summary.\n\n**Track for this cycle:**\n- branches_merged: count and names of successfully merged branches\n- branches_conflict: count and names of branches skipped due to conflicts\n- conflict_tasks: IDs of conflict-resolution tasks created\n\nThis tracking feeds into generate-summary for the patrol digest.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-z580u","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check for more work","updated_at":"2026-02-27T19:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:57:46Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:56:23Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-z9li9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:57:46Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2ddbf90c5f2fd2a7c20e2a15835e8489710306821cb25baf7f830f9c0319fa4b","created_at":"2026-02-27T20:13:21Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge and push. CRITICAL: Notifications come IMMEDIATELY after push.\n\n**Config: integration_branch_refinery_enabled = true**\n**Config: target_branch = main**\n**Config: delete_merged_branches = true**\n\nWhen integration_branch_refinery_enabled = \"true\", the MR's target branch\nmay be an integration branch (not just main). Check the MR's target field and use\nthat as the merge destination. Only fall back to main if no explicit target is set.\n\n**Step 1: Merge and Push**\nDetermine the merge target: use the MR's target field if set, otherwise main.\n```bash\ngit checkout \u003cmerge-target\u003e\ngit merge --ff-only temp\ngit push origin \u003cmerge-target\u003e\n```\n\n**Step 1.5: VERIFY PUSH SUCCEEDED (CRITICAL - PATCH-003)**\n\nPush can fail silently (network, auth, hooks). IMMEDIATELY verify:\n```bash\ngit fetch origin\nLOCAL_SHA=$(git rev-parse \u003cmerge-target\u003e)\nREMOTE_SHA=$(git rev-parse origin/\u003cmerge-target\u003e)\necho \"Local:  $LOCAL_SHA\"\necho \"Remote: $REMOTE_SHA\"\n```\n\n**If SHAs match**: Push succeeded. Continue to Step 2.\n\n**If SHAs differ**: STOP. Push failed silently.\n- DO NOT send MERGED notification\n- DO NOT close MR bead\n- DO NOT delete branch\n- Debug the push failure (check `git push` output, network, auth)\n- Retry push and verify again before proceeding\n\n⚠️ **STOP HERE - DO NOT PROCEED UNTIL STEPS 1.5 AND 2-3 COMPLETE**\n\n**Step 2: Send MERGED Notification (REQUIRED - DO THIS IMMEDIATELY)**\n\nRIGHT NOW, before any cleanup, send MERGED mail to Witness:\n\n```bash\ngt mail send \u003crig\u003e/witness -s \"MERGED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\nIssue: \u003cissue-id\u003e\nMerged-At: $(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n```\n\nThis signals the Witness to nuke the polecat worktree. WITHOUT THIS NOTIFICATION,\nPOLECAT WORKTREES ACCUMULATE INDEFINITELY AND THE LIFECYCLE BREAKS.\n\n**Step 3: Close MR Bead (REQUIRED - DO THIS IMMEDIATELY)**\n\n⚠️ **VERIFICATION BEFORE CLOSING**: Confirm the work is actually on the merge target:\n```bash\n# Get the commit message/issue from the branch\ngit log origin/\u003cmerge-target\u003e --oneline | grep \"\u003cissue-id\u003e\"\n# OR verify the commit SHA is on the target:\ngit branch --contains \u003ccommit-sha\u003e | grep \u003cmerge-target\u003e\n```\n\nIf work is NOT on the merge target, DO NOT close the MR bead. Investigate first.\n\n```bash\nbd close \u003cmr-bead-id\u003e --reason \"Merged to \u003cmerge-target\u003e at $(git rev-parse --short HEAD)\"\n```\n\nThe MR bead ID was in the MERGE_READY message or find via:\n```bash\nbd list --type=merge-request --status=open | grep \u003cpolecat-name\u003e\n```\n\n**VALIDATION**: The MR bead's source_issue should be a valid bead ID (gt-xxxxx),\nnot a branch name. If source_issue contains a branch name, flag for investigation.\n\n**Step 4: Archive the MERGE_READY mail (REQUIRED)**\n```bash\ngt mail archive \u003cmerge-ready-message-id\u003e\n```\nThe message ID was tracked when you processed inbox-check.\n\n**Step 5: Cleanup (only after Steps 2-4 confirmed)**\n```bash\ngit branch -d temp\n```\n\ndelete_merged_branches (see config above) controls whether to delete the remote source branch.\n\nIf delete_merged_branches is \"true\":\n```bash\ngit push origin --delete \u003cpolecat-branch\u003e\n```\n\nIf delete_merged_branches is \"false\": Leave the remote branch intact.\n\n**VERIFICATION GATE**: You CANNOT proceed to loop-check without:\n- [x] MERGED mail sent to witness\n- [x] MR bead closed\n- [x] MERGE_READY mail archived\n\nIf you skipped notifications or archiving, GO BACK AND DO THEM NOW.\n\nTarget branch has moved. Any remaining branches need rebasing on new baseline.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-za07a","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Merge and push","updated_at":"2026-02-27T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"stale patrol cleanup","closed_at":"2026-02-27T19:27:54Z","closed_by_session":"f915f087-8f31-4531-8baa-e3c31c5d4e86","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2038d263f5ca0f203080d4a1b372ca4dd60e677f62ee09a1095e5f42c9842230","created_at":"2026-02-27T19:24:20Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Merge queue processor patrol loop.\n\nThe Refinery is the Engineer in the engine room. You process polecat branches, merging them to main one at a time with sequential rebasing.\n\n**The Scotty Test**: Before proceeding past any failure, ask yourself: \"Would Scotty walk past a warp core leak because it existed before his shift?\"\n\n## Merge Flow\n\nThe Refinery receives MERGE_READY mail from Witnesses when polecats complete work:\n\n```\nWitness                    Refinery                      Git\n   │                          │                           │\n   │ MERGE_READY              │                           │\n   │─────────────────────────\u003e│                           │\n   │                          │                           │\n   │                    (verify branch)                   │\n   │                          │ fetch \u0026 rebase            │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │                    (run tests)                       │\n   │                          │                           │\n   │                    (if pass)                         │\n   │                          │ merge \u0026 push              │\n   │                          │──────────────────────────\u003e│\n   │                          │                           │\n   │ MERGED                   │                           │\n   │\u003c─────────────────────────│                           │\n   │                          │                           │\n```\n\nAfter successful merge, Refinery sends MERGED mail back to Witness so it can\ncomplete cleanup (nuke the polecat worktree).\n\n## CRITICAL: Read Step Instructions Before Acting\n\nBefore executing ANY step, you MUST run `bd show \u003cstep-id\u003e` and read the full\ndescription. Steps contain **Config:** values that override default behavior.\nIf a config says to skip, you skip. If it specifies a command, you use that\nexact command — not your own assumption. Do NOT guess what a step requires\nbased on the step title or your role knowledge. The step description is the\nsource of truth.\n\n## Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| wisp_type | patrol | Type of wisp created for this molecule |\n| integration_branch_refinery_enabled | true | Whether refinery merges to integration branches |\n| integration_branch_auto_land | false | Whether to auto-land integration branches when epic children all closed |\n| run_tests | true | Whether to run tests before merging |\n| setup_command | (empty) | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | (empty) | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| lint_command | (empty) | Lint command (e.g., `eslint .`). Empty = skip. |\n| test_command | go test ./... | Test command to run (if run_tests is true) |\n| build_command | (empty) | Build command (e.g., `go build ./...`). Empty = skip. |\n| target_branch | main | Default target branch for merges |\n| delete_merged_branches | true | Whether to delete source branches after merge |\n\n## FORBIDDEN Actions\n\n- FORBIDDEN: Landing integration branches to the default branch via raw git commands (`git merge`, `git push`).\n  Integration branches may ONLY be landed via `gt mq integration land \u003cepic-id\u003e`.\n  This applies regardless of `auto_land` configuration. The pre-push hook enforces this.\n\n## Step Execution Order\n\nYou MUST process steps in strict DAG order. Walk through each step sequentially,\nunless you are explicitly told to skip to a step.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zcc7f","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"mol-refinery-patrol","updated_at":"2026-02-27T19:27:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zcou9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:40:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:43:24Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96ef84ca7082e3e0e96000c6314b182f1b04a1c7aaa3b51ea62842e3a99e9af8","created_at":"2026-02-27T19:41:47Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should contain ONLY:\n- Unprocessed MERGE_READY messages (will process next cycle)\n- Active work items\n\n**Step 2: Archive any stale messages**\n\nLook for messages that were processed but not archived:\n- PATROL: Wake up that was acknowledged → archive\n- HELP/Blocked that was handled → archive\n- MERGE_READY where merge completed but archive was missed → archive\n\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Step 3: Check for orphaned MR beads**\n\nLook for open MR beads with no corresponding branch:\n```bash\nbd list --type=merge-request --status=open\n```\n\nFor each open MR bead:\n1. Check if branch exists: `git ls-remote origin refs/heads/\u003cbranch\u003e`\n2. If branch gone, verify work is on main: `git log origin/main --oneline | grep \"\u003csource_issue\u003e\"`\n3. If work on main → close MR with reason \"Merged (verified on main)\"\n4. If work NOT on main → investigate before closing:\n   - Check source_issue validity (should be gt-xxxxx, not branch name)\n   - Search reflog/dangling commits if possible\n   - If unverifiable, close with reason \"Unverifiable - no audit trail\"\n   - File bead if this indicates lost work\n\n**NEVER close an MR bead without verifying the work landed or is unrecoverable.**\n\n**Goal**: Inbox should have ≤3 active messages at end of cycle.\nKeep only: pending MRs in queue.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zh15m","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"End-of-cycle inbox hygiene","updated_at":"2026-02-27T19:43:24Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:52:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3288d51c885aa8532598659413ab67d8f6b6d20d1b5b441afc5b0dabaa374e2f","created_at":"2026-02-27T19:52:12Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Check mail for MERGE_READY submissions, escalations, and messages.\n\n```bash\ngt mail inbox\n```\n\nFor each message:\n\n**MERGE_READY**:\nA polecat's work is ready for merge. Extract details and track for processing.\n\n```bash\n# Parse MERGE_READY message body:\n# Branch: \u003cbranch\u003e\n# Issue: \u003cissue-id\u003e\n# Polecat: \u003cpolecat-name\u003e\n# MR: \u003cmr-bead-id\u003e\n# Verified: clean git state, issue closed\n\n# Track in your merge queue for this patrol cycle:\n# - Branch name\n# - Issue ID\n# - Polecat name (REQUIRED for MERGED notification)\n# - MR bead ID (REQUIRED for closing after merge)\n```\n\n**IMPORTANT**: You MUST track the polecat name, MR bead ID, AND message ID - you will need them\nin merge-push step to send MERGED notification, close the MR bead, and archive the mail.\n\nMark as read. The work will be processed in queue-scan/process-branch.\n**Do NOT archive yet** - archive after merge/reject decision in merge-push step.\n\n**PATROL: Wake up**:\nWitness detected MRs waiting but refinery idle. Acknowledge and archive:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Blocked**:\nAssess and respond. If you can't help, escalate to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HANDOFF**:\nRead predecessor context. Check for in-flight merges.\nArchive after absorbing context:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep only: pending MRs in queue. Inbox should be near-empty.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zkkwl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check refinery mail","updated_at":"2026-02-27T19:52:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:17:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:17:11Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zmnk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:17:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:38:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac0250a7b4f2b22febf39e8d211d40bcd13bc5f5151db79672885fcddebca333","created_at":"2026-02-27T19:37:17Z","created_by":"","crystallizes":0,"defer_until":null,"description":"Pick next branch from queue. Attempt mechanical rebase on current main.\n\n**Config: target_branch = main**\n\n**Step 1: Checkout and attempt rebase**\n```bash\ngit checkout -b temp origin/\u003cpolecat-branch\u003e\ngit rebase origin/main\n```\n\n**Step 2: Check rebase result**\n\nThe rebase exits with:\n- Exit code 0: Success - proceed to run-tests\n- Exit code 1 (conflicts): Conflict detected - proceed to Step 3\n\nTo detect conflict state after rebase fails:\n```bash\n# Check if we're in a conflicted rebase state\nls .git/rebase-merge 2\u003e/dev/null \u0026\u0026 echo \"CONFLICT_STATE\"\n```\n\n**Step 3: Handle conflicts (if any)**\n\nIf rebase SUCCEEDED (exit code 0):\n- Skip to run-tests step (continue normal merge flow)\n\nIf rebase FAILED with conflicts:\n\n1. **Abort the rebase** (DO NOT leave repo in conflicted state):\n```bash\ngit rebase --abort\n```\n\n2. **Record conflict metadata**:\n```bash\n# Capture main SHA for reference\nMAIN_SHA=$(git rev-parse origin/main)\nBRANCH_SHA=$(git rev-parse origin/\u003cpolecat-branch\u003e)\n```\n\n3. **Create conflict-resolution task**:\n```bash\nbd create --type=task --priority=1 --title=\"Resolve merge conflicts: \u003coriginal-issue-title\u003e\" --description=\"## Conflict Resolution Required\n\nOriginal MR: \u003cmr-bead-id\u003e\nBranch: \u003cpolecat-branch\u003e\nOriginal Issue: \u003cissue-id\u003e\nConflict with main at: ${MAIN_SHA}\nBranch SHA: ${BRANCH_SHA}\n\n## Instructions\n1. Clone/checkout the branch\n2. Rebase on current main: git rebase origin/main\n3. Resolve conflicts\n4. Force push: git push -f origin \u003cbranch\u003e\n5. Close this task when done\n\nThe MR will be re-queued for processing after conflicts are resolved.\"\n```\n\n4. **Skip this MR** (do NOT delete branch or close MR bead):\n- Leave branch intact for conflict resolution\n- Leave MR bead open (will be re-processed after resolution)\n- Continue to loop-check for next branch\n\n**CRITICAL**: Never delete a branch that has conflicts. The branch contains\nthe original work and must be preserved for conflict resolution.\n\nTrack: rebase result (success/conflict), conflict task ID if created.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zn8y8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mechanical rebase","updated_at":"2026-02-27T19:38:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:22:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9742ae1fab9e73984581e4aacf23f1a5675564600ae2da6e3e08eb76135a7ed5","created_at":"2026-02-27T19:21:30Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**Config: integration_branch_refinery_enabled = true**\n**Config: integration_branch_auto_land = false**\n\nRead the two config values above, then:\n\n- If integration_branch_refinery_enabled = \"false\": Say \"Integration branches disabled.\" Close step.\n- If integration_branch_auto_land = \"false\": Say \"Auto-land disabled, nothing to do.\" Close step.\n  FORBIDDEN: If auto_land is false, you MUST NOT land integration branches yourself using\n  raw git commands. Do not merge integration branches to the default/target branch. Do not push\n  integration branch merges. The auto_land=false setting means landing requires a human\n  to run `gt mq integration land` manually. Respect this boundary unconditionally.\n- If BOTH are \"true\":\n  1. `bd list --type=epic --status=open` to find epics\n  2. `gt mq integration status \u003cepic-id\u003e` for each epic\n  3. If `ready_to_land: true`: run `gt mq integration land \u003cepic-id\u003e`\n  4. If `ready_to_land: false`: do nothing, epic work is incomplete\n  Never land partial epics — ALL children must be closed first.","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zrnb1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Check integration branches for landing","updated_at":"2026-02-27T19:22:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:40:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:40:05Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zvwwh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:40:35Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"bobbin/refinery","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T19:30:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4075f518aee90fe432a71bb867d21eb597313cc89b5d86b344f6db5836b3b8c7","created_at":"2026-02-27T19:30:01Z","created_by":"","crystallizes":0,"defer_until":null,"description":"**VERIFICATION GATE**: This step enforces the Beads Promise.\n\nIf all checks and tests PASSED: This step auto-completes. Proceed to merge.\n\nIf any check or test FAILED:\n1. Diagnose: Is this a branch regression or pre-existing on the target branch?\n2. If branch caused it:\n   - Abort merge\n   - **REOPEN the source issue** so it returns to the ready queue:\n     ```bash\n     bd update \u003cissue-id\u003e --status=open --assignee=\"\"\n     bd sync\n     ```\n   - Notify witness of rejection using the MERGE_FAILED protocol:\n     ```bash\n     gt mail send \u003crig\u003e/witness -s \"MERGE_FAILED \u003cpolecat-name\u003e\" -m \"Branch: \u003cbranch\u003e\n     Issue: \u003cissue-id\u003e\n     Polecat: \u003cpolecat-name\u003e\n     Rig: \u003crig\u003e\n     FailureType: quality-check\n     Error: \u003cfailure description\u003e\"\n     ```\n   - Close the MR bead as rejected:\n     ```bash\n     bd close \u003cmr-bead-id\u003e --reason \"Rejected: \u003cfailure description\u003e\"\n     ```\n   - Delete the rejected branch (a new polecat will create a fresh one):\n     ```bash\n     git push origin --delete \u003cpolecat-branch\u003e\n     ```\n   - Archive the MERGE_READY message\n   - Skip to loop-check\n3. If pre-existing on the target branch:\n   - File a bead: bd create --type=bug --priority=1 --title=\"...\"\n   - FORBIDDEN: Writing code to fix quality check or test failures. You merge branches, you do not develop.\n   - Proceed with the merge if the failure is pre-existing (not caused by the branch).\n\n**REJECTION CHECKLIST** (all required before skipping to loop-check):\n- [ ] Source issue reopened (bd update \u003cissue-id\u003e --status=open --assignee=\"\")\n- [ ] MERGE_FAILED notification sent to witness\n- [ ] MR bead closed with rejection reason\n- [ ] Rejected branch deleted from remote\n- [ ] MERGE_READY message archived\n\n**GATE REQUIREMENT**: You CANNOT proceed to merge-push without:\n- All quality checks and tests passing, OR\n- Bead filed for the pre-existing failure\n\nFORBIDDEN: Writing application code, exploring polecat implementations, or\nre-implementing fixes. You are a mechanical merge processor.\n\nThis is non-negotiable. Never disavow. Never \"note and proceed.\" ","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"BOB-wisp-zxye0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Handle quality check or test failures","updated_at":"2026-02-27T19:30:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b2fc9572986f4a050f2be98dcc683ac6533f3cfc71cb54752b7d2b183155d44d","created_at":"2026-02-28T14:18:02Z","created_by":"aegis/crew/stryder","crystallizes":0,"defer_until":null,"description":"settings-with-bobbin.json uses '--show-docs false' on inject-context hook, but ruff-004 (Feb 27 run) returned 9 doc files and 0 source files. The metadata confirms classification is correct (doc_files: 9, source_files: 0), but the files weren't filtered out. Either --show-docs false has a bug, or there's a fallback when no source files exist. This defeats doc demotion for queries that only match changelogs/docs.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-945","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"show-docs false not filtering doc files from injection output","updated_at":"2026-02-28T14:18:02Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"69620f732bf7dee71a50d5755c55798632cdf6960c05d495c970ab51a6eaa473","created_at":"2026-02-28T03:00:00Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Crew worker goldblum in bobbin - human-managed persistent workspace.\n\nrole_type: crew\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-bobbin-crew-goldblum","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Crew worker goldblum in bobbin - human-managed persistent workspace.","updated_at":"2026-02-28T03:00:00Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8e917cbc3fbbdbb2d06233dcdf4ec27793bf9111735c929252866f699cbbbbc2","created_at":"2026-02-28T03:00:00Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Crew worker seth in bobbin - human-managed persistent workspace.\n\nrole_type: crew\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-bobbin-crew-seth","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Crew worker seth in bobbin - human-managed persistent workspace.","updated_at":"2026-02-28T03:00:00Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"7bf345906fb6e4cde64647f9eb0427d40c314b7e7b7334440f18bf3b95e1bbfb","created_at":"2026-02-28T03:00:01Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Crew worker strider in bobbin - human-managed persistent workspace.\n\nrole_type: crew\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-bobbin-crew-strider","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Crew worker strider in bobbin - human-managed persistent workspace.","updated_at":"2026-02-28T03:00:01Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5ab6bdaaa8c5338b2597165b5fa857fb9f60c5ed41159013f45a77cf2436af73","created_at":"2026-02-28T03:00:00Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Refinery for bobbin - processes merge queue.\n\nrole_type: refinery\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-bobbin-refinery","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Refinery for bobbin - processes merge queue.","updated_at":"2026-02-28T03:00:00Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0285781a72acb0016999500b81ba9cc10db9f17d3cc6070e726de1f971c89528","created_at":"2026-02-28T03:00:00Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Witness for bobbin - monitors polecat health and progress.\n\nrole_type: witness\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-bobbin-witness","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Witness for bobbin - monitors polecat health and progress.","updated_at":"2026-02-28T03:00:00Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8e32bf81685bc84bbba986d5887458747b2454db06b93c228a982faa01ef4be4","created_at":"2026-02-28T14:17:55Z","created_by":"aegis/crew/stryder","crystallizes":0,"defer_until":null,"description":"Agents consistently try 'bobbin refs FormatExceptHandler' but the CLI requires 'bobbin refs find FormatExceptHandler'. The bare-symbol form is what users and agents intuitively expect. Either: (a) make the bare form work as an alias for 'bobbin refs find', or (b) if ambiguous, show a helpful error suggesting the subcommand. Discovered via eval metrics — agents fail on this in every single ruff eval run. See eval metrics for ruff-001..005 (Feb 26-27 runs).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-c7f","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"bobbin refs should accept bare symbol name (bobbin refs SymbolName)","updated_at":"2026-02-28T14:17:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9423b2c111ebe6dd25b044b590e73e59072a6c2b34432b60acfc4b91266d257e","created_at":"2026-02-28T14:18:09Z","created_by":"aegis/crew/stryder","crystallizes":0,"defer_until":null,"description":"Calibration (bobbin calibrate) tunes search weights using git commit messages as queries. But the eval framework passes long multi-sentence task descriptions as the prompt. These are very different query profiles — short identifier-heavy commit messages vs long descriptive paragraphs. The long form more closely approximates real user prompts. Need to: (1) Investigate whether calibration results are valid for long-form queries, (2) Consider adding a calibration mode that uses longer synthetic queries or task descriptions, (3) Run A/B comparison: calibrated weights vs defaults on long-form eval tasks. This may explain why ruff calibration showed sw=0.00 as best (pure keyword) — commit messages ARE keyword queries.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-kkn","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Eval injection quality: calibration uses commit messages but eval uses long task descriptions","updated_at":"2026-02-28T14:18:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"531a58655702766776ccdbbe647574c9c01b16fdd88bdec8827f4a5b20090972","created_at":"2026-02-28T14:17:59Z","created_by":"aegis/crew/stryder","crystallizes":0,"defer_until":null,"description":"In eval runs, agents call 'bobbin related crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs' and get 'Error: File not found in index'. The eval checks out the parent commit (before the fix), and the file exists on disk but wasn't indexed. bobbin related should either: (a) handle files that exist on disk but aren't in the index by offering to re-index, or (b) fall back to git coupling data for the path even if not in the embedding index. Discovered in ruff-002 and ruff-003 eval runs (Feb 27).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-nlm","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"bobbin related fails on files not yet in index","updated_at":"2026-02-28T14:17:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"039ba65d3eb773c20a01ae539e825536478a1443ab86f33517d3b32d7f448086","created_at":"2026-02-28T03:00:08Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Rig identity bead for bobbin.\n\nrepo: git@github.com:scbrown/bobbin.git\nprefix: bo\nstate: active","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bo-rig-bobbin","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"bobbin","updated_at":"2026-02-28T03:00:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"69620f732bf7dee71a50d5755c55798632cdf6960c05d495c970ab51a6eaa473","created_at":"2026-02-28T10:27:59Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Crew worker goldblum in bobbin - human-managed persistent workspace.\n\nrole_type: crew\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bobbin-bobbin-crew-goldblum","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Crew worker goldblum in bobbin - human-managed persistent workspace.","updated_at":"2026-02-28T10:27:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8e917cbc3fbbdbb2d06233dcdf4ec27793bf9111735c929252866f699cbbbbc2","created_at":"2026-02-28T10:27:59Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Crew worker seth in bobbin - human-managed persistent workspace.\n\nrole_type: crew\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bobbin-bobbin-crew-seth","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Crew worker seth in bobbin - human-managed persistent workspace.","updated_at":"2026-02-28T10:27:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"7bf345906fb6e4cde64647f9eb0427d40c314b7e7b7334440f18bf3b95e1bbfb","created_at":"2026-02-28T10:27:59Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Crew worker strider in bobbin - human-managed persistent workspace.\n\nrole_type: crew\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bobbin-bobbin-crew-strider","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Crew worker strider in bobbin - human-managed persistent workspace.","updated_at":"2026-02-28T10:27:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5ab6bdaaa8c5338b2597165b5fa857fb9f60c5ed41159013f45a77cf2436af73","created_at":"2026-02-28T10:27:59Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Refinery for bobbin - processes merge queue.\n\nrole_type: refinery\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bobbin-bobbin-refinery","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Refinery for bobbin - processes merge queue.","updated_at":"2026-02-28T10:27:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0285781a72acb0016999500b81ba9cc10db9f17d3cc6070e726de1f971c89528","created_at":"2026-02-28T10:27:59Z","created_by":"aegis/crew/ian","crystallizes":0,"defer_until":null,"description":"Witness for bobbin - monitors polecat health and progress.\n\nrole_type: witness\nrig: bobbin\nagent_state: idle\nhook_bead: null\ncleanup_status: null\nactive_mr: null\nnotification_level: null","design":"","due_at":null,"ephemeral":1,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"bobbin-bobbin-witness","is_template":0,"issue_type":"agent","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"sentinel@aegis.svc","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Witness for bobbin - monitors polecat health and progress.","updated_at":"2026-02-28T10:27:59Z","waiters":"","wisp_type":"","work_type":""}
