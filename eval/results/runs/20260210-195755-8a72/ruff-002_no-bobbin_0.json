{
  "task_id": "ruff-002",
  "approach": "no-bobbin",
  "attempt": 0,
  "status": "completed",
  "timestamp": "2026-02-10T20:02:34.692511+00:00",
  "task": {
    "repo": "astral-sh/ruff",
    "commit": "ddeadcbd18a2b3319a2f5963c16191d14d44bca9",
    "test_command": "cargo test -p ruff_linter -- flake8_boolean_trap",
    "language": "rust",
    "difficulty": "easy"
  },
  "agent_result": {
    "exit_code": 0,
    "duration_seconds": 265.64,
    "timed_out": false
  },
  "test_result": {
    "passed": true,
    "total": 0,
    "failures": 0,
    "parsed": {
      "framework": "pytest",
      "passed": 0,
      "failed": 0,
      "skipped": 0,
      "total": 0
    }
  },
  "diff_result": {
    "file_precision": 1.0,
    "file_recall": 0.4,
    "f1": 0.5714,
    "files_touched": [
      "crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py",
      "crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs"
    ],
    "ground_truth_files": [
      "crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py",
      "crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs",
      "crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT001_FBT.py.snap",
      "crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT003_FBT.py.snap",
      "crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__extend_allowed_callable.snap"
    ],
    "exact_file_match": false
  },
  "agent_diff": "diff --git a/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py b/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py\nindex 1c872e44ac..c4f9c6bd61 100644\n--- a/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py\n+++ b/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py\n@@ -160,6 +160,12 @@ class Settings(BaseSettings):\n class SupportsXorBool:\n     def __xor__(self, other: bool) -> Self: ...\n \n+# Test multiprocessing.Value - should be excluded from FBT003\n+from multiprocessing import Value\n+\n+shared_flag = Value(\"b\", False)\n+shared_counter = Value(\"i\", 0)\n+\n # check overload\n class CustomFloat:\n     @overload\ndiff --git a/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs b/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs\nindex de0f27f23d..c37bd1a8b9 100644\n--- a/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs\n+++ b/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs\n@@ -50,6 +50,23 @@ pub(super) fn is_allowed_func_call(name: &str) -> bool {\n     )\n }\n \n+/// Returns `true` if a call is semantically allowed to use a boolean trap.\n+/// This uses qualified name resolution to match specific functions that\n+/// commonly accept boolean positional arguments.\n+pub(super) fn is_semantically_allowed_func_call(\n+    call: &ast::ExprCall,\n+    semantic: &SemanticModel,\n+) -> bool {\n+    semantic\n+        .resolve_qualified_name(call.func.as_ref())\n+        .is_some_and(|qualified_name| {\n+            matches!(\n+                qualified_name.segments(),\n+                [\"multiprocessing\", \"Value\"]\n+            )\n+        })\n+}\n+\n /// Returns `true` if a call is allowed by the user to use a boolean trap.\n pub(super) fn is_user_allowed_func_call(\n     call: &ast::ExprCall,\n@@ -186,6 +203,12 @@ pub(super) fn allow_boolean_trap(call: &ast::ExprCall, checker: &Checker) -> boo\n         }\n     }\n \n+    // If the call is semantically allowed (using qualified name resolution), then the\n+    // boolean trap is allowed.\n+    if is_semantically_allowed_func_call(call, checker.semantic()) {\n+        return true;\n+    }\n+\n     // If the call is explicitly allowed by the user, then the boolean trap is allowed.\n     if is_user_allowed_func_call(call, checker.semantic(), checker.settings()) {\n         return true;\n",
  "ground_truth_diff": "diff --git a/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py b/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py\nindex 1c872e44ac..5062970ea2 100644\n--- a/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py\n+++ b/crates/ruff_linter/resources/test/fixtures/flake8_boolean_trap/FBT.py\n@@ -73,6 +73,9 @@ sa.func.coalesce(tbl.c.valid, False)\n setVisible(True)\n set_visible(True)\n \n+from multiprocessing import Value as m_Value\n+m_Value(\"b\", True)\n+\n \n class Registry:\n     def __init__(self) -> None:\ndiff --git a/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs b/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs\nindex de0f27f23d..d851d0b0fe 100644\n--- a/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs\n+++ b/crates/ruff_linter/src/rules/flake8_boolean_trap/helpers.rs\n@@ -50,6 +50,21 @@ pub(super) fn is_allowed_func_call(name: &str) -> bool {\n     )\n }\n \n+/// Returns `true` if a call is semantically allowed to use a boolean trap.\n+pub(super) fn is_semantically_allowed_func_call(\n+    call: &ast::ExprCall,\n+    semantic: &SemanticModel,\n+) -> bool {\n+    semantic\n+        .resolve_qualified_name(call.func.as_ref())\n+        .is_some_and(|qualified_name| {\n+            [\"multiprocessing.Value\"]\n+                .iter()\n+                .map(|target| QualifiedName::from_dotted_name(target))\n+                .any(|target| qualified_name == target)\n+        })\n+}\n+\n /// Returns `true` if a call is allowed by the user to use a boolean trap.\n pub(super) fn is_user_allowed_func_call(\n     call: &ast::ExprCall,\n@@ -186,6 +201,11 @@ pub(super) fn allow_boolean_trap(call: &ast::ExprCall, checker: &Checker) -> boo\n         }\n     }\n \n+    // If the function is explicitly allowed, then the boolean trap is allowed.\n+    if is_semantically_allowed_func_call(call, checker.semantic()) {\n+        return true;\n+    }\n+\n     // If the call is explicitly allowed by the user, then the boolean trap is allowed.\n     if is_user_allowed_func_call(call, checker.semantic(), checker.settings()) {\n         return true;\ndiff --git a/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT001_FBT.py.snap b/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT001_FBT.py.snap\nindex de000a9ef2..b1db41981e 100644\n--- a/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT001_FBT.py.snap\n+++ b/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT001_FBT.py.snap\n@@ -90,27 +90,27 @@ FBT001 Boolean-typed positional argument in function definition\n    |\n \n FBT001 Boolean-typed positional argument in function definition\n-  --> FBT.py:90:19\n+  --> FBT.py:93:19\n    |\n-89 |     # FBT001: Boolean positional arg in function definition\n-90 |     def foo(self, value: bool) -> None:\n+92 |     # FBT001: Boolean positional arg in function definition\n+93 |     def foo(self, value: bool) -> None:\n    |                   ^^^^^\n-91 |         pass\n+94 |         pass\n    |\n help: Consider adding `@typing.override` if changing the function signature would violate the Liskov Substitution Principle\n \n FBT001 Boolean-typed positional argument in function definition\n-   --> FBT.py:100:10\n+   --> FBT.py:103:10\n     |\n-100 | def func(x: Union[list, Optional[int | str | float | bool]]):\n+103 | def func(x: Union[list, Optional[int | str | float | bool]]):\n     |          ^\n-101 |     pass\n+104 |     pass\n     |\n \n FBT001 Boolean-typed positional argument in function definition\n-   --> FBT.py:104:10\n+   --> FBT.py:107:10\n     |\n-104 | def func(x: bool | str):\n+107 | def func(x: bool | str):\n     |          ^\n-105 |     pass\n+108 |     pass\n     |\ndiff --git a/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT003_FBT.py.snap b/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT003_FBT.py.snap\nindex e056ac76bc..667df5dbbb 100644\n--- a/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT003_FBT.py.snap\n+++ b/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__FBT003_FBT.py.snap\n@@ -32,37 +32,37 @@ FBT003 Boolean positional value in function call\n    |\n \n FBT003 Boolean positional value in function call\n-   --> FBT.py:120:10\n+   --> FBT.py:123:10\n     |\n-120 | settings(True)\n+123 | settings(True)\n     |          ^^^^\n     |\n \n FBT003 Boolean positional value in function call\n-   --> FBT.py:144:20\n+   --> FBT.py:147:20\n     |\n-142 |     is_foo_or_bar=Case(\n-143 |         When(Q(is_foo=True) | Q(is_bar=True)),\n-144 |         then=Value(True),\n+145 |     is_foo_or_bar=Case(\n+146 |         When(Q(is_foo=True) | Q(is_bar=True)),\n+147 |         then=Value(True),\n     |                    ^^^^\n-145 |     ),\n-146 |     default=Value(False),\n+148 |     ),\n+149 |     default=Value(False),\n     |\n \n FBT003 Boolean positional value in function call\n-   --> FBT.py:146:19\n+   --> FBT.py:149:19\n     |\n-144 |         then=Value(True),\n-145 |     ),\n-146 |     default=Value(False),\n+147 |         then=Value(True),\n+148 |     ),\n+149 |     default=Value(False),\n     |                   ^^^^^\n-147 | )\n+150 | )\n     |\n \n FBT003 Boolean positional value in function call\n-   --> FBT.py:156:23\n+   --> FBT.py:159:23\n     |\n-155 | class Settings(BaseSettings):\n-156 |     foo: bool = Field(True, exclude=True)\n+158 | class Settings(BaseSettings):\n+159 |     foo: bool = Field(True, exclude=True)\n     |                       ^^^^\n     |\ndiff --git a/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__extend_allowed_callable.snap b/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__extend_allowed_callable.snap\nindex 3630d70274..135c26367d 100644\n--- a/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__extend_allowed_callable.snap\n+++ b/crates/ruff_linter/src/rules/flake8_boolean_trap/snapshots/ruff_linter__rules__flake8_boolean_trap__tests__extend_allowed_callable.snap\n@@ -32,8 +32,8 @@ FBT003 Boolean positional value in function call\n    |\n \n FBT003 Boolean positional value in function call\n-   --> FBT.py:120:10\n+   --> FBT.py:123:10\n     |\n-120 | settings(True)\n+123 | settings(True)\n     |          ^^^^\n     |\n",
  "project_metadata": {
    "CSS": {
      "files": 3,
      "lines": 377,
      "code": 322,
      "comments": 6,
      "blanks": 49
    },
    "Dockerfile": {
      "files": 1,
      "lines": 38,
      "code": 26,
      "comments": 7,
      "blanks": 5
    },
    "HTML": {
      "files": 2,
      "lines": 81,
      "code": 81,
      "comments": 0,
      "blanks": 0
    },
    "JavaScript": {
      "files": 2,
      "lines": 97,
      "code": 77,
      "comments": 11,
      "blanks": 9
    },
    "JSON": {
      "files": 134,
      "lines": 15810,
      "code": 15800,
      "comments": 0,
      "blanks": 10
    },
    "Jupyter Notebooks": {
      "files": 35,
      "lines": 511,
      "code": 289,
      "comments": 154,
      "blanks": 68
    },
    "Markdown": {
      "files": 399,
      "lines": 122962,
      "code": 0,
      "comments": 89569,
      "blanks": 33393
    },
    "Python": {
      "files": 3689,
      "lines": 267054,
      "code": 212111,
      "comments": 12821,
      "blanks": 42122
    },
    "Rust": {
      "files": 1749,
      "lines": 520251,
      "code": 440208,
      "comments": 25705,
      "blanks": 54338
    },
    "Shell": {
      "files": 15,
      "lines": 489,
      "code": 274,
      "comments": 143,
      "blanks": 72
    },
    "SVG": {
      "files": 28,
      "lines": 1445,
      "code": 1308,
      "comments": 71,
      "blanks": 66
    },
    "Plain Text": {
      "files": 43,
      "lines": 188649,
      "code": 0,
      "comments": 188648,
      "blanks": 1
    },
    "TOML": {
      "files": 145,
      "lines": 4358,
      "code": 3654,
      "comments": 220,
      "blanks": 484
    },
    "TSX": {
      "files": 30,
      "lines": 5526,
      "code": 4810,
      "comments": 163,
      "blanks": 553
    },
    "TypeScript": {
      "files": 14,
      "lines": 480,
      "code": 363,
      "comments": 61,
      "blanks": 56
    },
    "YAML": {
      "files": 24,
      "lines": 3741,
      "code": 3130,
      "comments": 287,
      "blanks": 324
    },
    "Total": {
      "files": 0,
      "lines": 1211221,
      "code": 695462,
      "comments": 369759,
      "blanks": 146000
    }
  },
  "bobbin_metadata": null,
  "run_id": "20260210-195755-8a72"
}